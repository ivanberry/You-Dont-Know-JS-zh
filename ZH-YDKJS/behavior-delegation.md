## delegationè¡Œä¸º

ä¸Šä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å¼ºè°ƒäº†[[Prototype]]çš„ä¸€äº›åŸºç¡€æ€§åŸç†ï¼Œå®ç°æœºåˆ¶ç­‰ç­‰ï¼Œä¹Ÿé˜è¿°äº†å¤šå¹´æ¥å¯¹å®ƒå…³äºâ€œç±»â€æˆ–è€…â€œç»§æ‰¿â€çš„ä¸€äº›è¯¯è§£ï¼Œå®ƒå¥½åƒä¸€ä¸ªé­”ç›’ä¸€æ ·çš„å¸®æˆ‘ä»¬å®Œæˆä¸€äº›äº‹æƒ…ï¼Œä½†æ˜¯ï¼Œå°±å­¦ä¹ åº”ç”¨çš„è§’åº¦è€Œè¨€ï¼Œæˆ‘ä»¬åº”è¯¥æ·±å…¥å­¦ä¹ å®ƒï¼Œåœ¨è¿™ä¸€ç« é‡Œï¼Œæˆ‘ä»¬æ¥æ‹‰å¼€åŸå‹çš„ç¥ç§˜é¢çº±ï¼Œä»æœ¬è´¨ä¸ŠæŒæ¡å®ƒï¼Œä»è€Œæ›´å¥½åœ°ï¼Œæ›´ç›´æ¥å¤šåˆ©ç”¨åŸå‹ï¼Œè¿™æ— ç–‘æ˜¯æœ‰åˆ©äºæˆ‘ä»¬çš„å¼€å‘ï¼Œç”šè‡³æ˜¯ä»£ç ç»´æŠ¤å·¥ä½œçš„ã€‚

[[Prototype]]çš„æœºåˆ¶æ˜¯ï¼šæŸå¯¹è±¡ä¸ŠæŒ‡å‘å¦ä¸€å¯¹è±¡çš„ç´¢å¼•ã€‚

è¿™ç§å…³ç³»ä¸»è¦å­˜åœ¨äºå¯¹æŸå¯¹è±¡çš„æŸä¸€ä¸ªå±æ€§æˆ–æ–¹æ³•æŸ¥è¯¢æ—¶ï¼Œä½†æ˜¯è¿™ä¸ªå¯¹è±¡æœ¬èº«åˆæ²¡æœ‰å¯¹åº”çš„å±æ€§æˆ–æ–¹æ³•ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œ[[Prototype]]å°±ä¼šç«™å‡ºæ¥å¸®å¿™ï¼Œä»æˆ‘è¿™ä¸ªæ¥¼æ¢¯èµ°åˆ°ä½ å…³è”çš„å¦ä¸€ä¸ªå¯¹è±¡ï¼Œçœ‹å®ƒé‚£æœ‰æ²¡æœ‰ä½ è¦çš„è¿™ä¸ªå±æ€§æˆ–æ–¹æ³•ï¼Œå‡å¦‚ï¼Œåœ¨è¿™ä¸ªå¯¹è±¡åŒæ ·ä¹Ÿæ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆå®ƒæœ¬èº«çš„[[Prototype]]ä¹Ÿä¼šç«™å‡ºæ¥ï¼Œæ¥ï¼Œæ¥ï¼Œæ¥ï¼Œä»æˆ‘è¿™ä¸ªèµ°ï¼Œåˆ°ä½ è‡ªå·±å…³è”çš„å¯¹è±¡ä¸Šå»æ‰¾æ‰¾ã€‚è¿™äº›å¯¹è±¡é—´çš„è”ç³»æˆ‘ä»¬å°±ç§°ä¸ºåŸå‹é“¾ã€‚

æ¢å¥è¯è¯´ï¼ŒåŸå‹é“¾æœ€å…³é”®æœ¬è´¨çš„å°±æ˜¯å¯¹è±¡å…³è”ã€‚

## é¢å‘delegationçš„è®¾è®¡

ä¸ºäº†æ›´ç›´æ¥ä½¿ç”¨[[Prototype]]ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»æ˜ç¡®ï¼Œå®ƒåŒé¢å‘ç±»è®¾è®¡çš„å·®å¼‚ï¼å»ºç«‹å¥½è¿™ç§æ€ç»´åï¼Œæˆ‘ä»¬æ‰èƒ½æœ€æœ‰æ•ˆçš„åˆ©ç”¨å¥½çš„[[Prototype]]ã€‚

### ç±»

è¿™é‡Œæ˜¯å…³äºç±»çš„ä¸€äº›åŸºæœ¬åŸç†ï¼Œæˆ‘å°±è‡ªå·±çœ‹çœ‹åŸæ–‡äº†ï¼Œå°±ä¸åšç¿»è¯‘ï¼Œå› ä¸ºæˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ‡‚ï¼Œåªææœ€å…³é”®çš„ä¸€ç‚¹ï¼šç±»çš„å®ä¾‹æ˜¯å¤åˆ¶ã€‚

### delegation

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ç³»åˆ—ç›¸åŒçš„ä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒä»¬æ¨¡å—åŒ–ï¼Œä¸Šé¢æˆ‘ä»¬çœç•¥æ‰äº†åŸºäºç±»çš„è®¾è®¡ï¼Œè¿™é‡Œç»†ç»†å­¦ä¹ ä¸‹åŸºäºdelegationçš„è®¾è®¡ï¼š

é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå«`Tasks`çš„å¯¹è±¡ï¼Œå®ƒåŒ…å«ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼Œå®ƒä»¬å¯ä»¥ç”¨æ¥delegation toï¼Œæ¥ç€ï¼Œä¸ºæ¯ä¸€ä¸ªä»»åŠ¡æ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒä»¬åŒ…å«è‡ªå·±çš„ç‰¹æœ‰çš„ä»»åŠ¡æˆ–æ•°æ®ç­‰ç­‰ï¼ŒåŒæ—¶ï¼Œé€šè¿‡ä¸`Tasks`å¯¹è±¡çš„å…³è”ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®åˆ°å®šä¹‰åœ¨`Tasks`ä¸Šçš„é‚£äº›å¸¸ç”¨æ–¹æ³•ï¼š

```js
var Task = {
				setID: function(ID) {
								this.id = ID;
				},
				outputID: function() {
								console.log( this.id );
				}
};

//make XYZ delegation to Task

var XYZ = Object.create( Task );
XYZ.prepareTask = function( ID, Label ) {
				this.setID( ID );
				this.label = Label;
};

XYZ.outputTaskDetails = function() {
				this.output( ID );
				console.log( this.label );
};

```

ä¸Šè¿°ä»£ç ä¸­ï¼š`Task`å’Œ`XYZ`éƒ½ä¸æ˜¯ç±»ï¼Œå®ƒä»¬éƒ½ä»…ä»…åªæ˜¯ä¸€ä¸ªå¯¹è±¡è€Œå·²ï¼Œå…¶ä¸­`XYZ`é€šè¿‡`Object.create()`è‡³`[[Prototype]]``ä»£ç†åˆ°`Task`å¯¹è±¡ã€‚

æˆ‘ä»¬å¯ä»¥ç§°è¿™ç§å’Œä¼ ç»Ÿé¢å‘å¯¹è±¡çš„ç¼–ç ä¸ºé¢å‘å…³è”çš„ç¼–ç ï¼ˆè¿™åŸä½œè€…ä¹Ÿæ˜¯è„‘æ´å¤§å¼€ï¼‰ï¼Œç®€ç§°(OLOO)ï¼Œæˆ‘ä»¬çœŸæ­£å…³å¿ƒåœ°æ˜¯`XYZ`å¯¹è±¡ä»£ç†åˆ°`Task`ã€‚

JavaScriptä¸­ï¼Œ[[Prototype]]æœºåˆ¶ä½¿å¾—å¯¹è±¡é—´å»ºç«‹äº†è”ç³»ï¼Œè¿™ç§æ–¹å¼æ²¡æœ‰é¢å‘å¯¹è±¡çš„é‚£äº›æŠ½è±¡æ¦‚å¿µï¼Œä¸ç®¡ä½ æ€ä¹ˆè¯´æœè‡ªå·±ï¼Œåªä¸è¿‡æ˜¯åœ¨ç”¨å¤æ‚çš„æ–¹æ³•æ¥å®ç°ä¸€ä¸ªæœ¬æ¥å°±å¾ˆè‡ªç„¶çš„åŠŸèƒ½è€Œå·²ï¼Œç”¨å’±ä¸­å›½äººè¯è¯´ï¼šä½ è¿™æ˜¯è´¹åŠ›ä¸è®¨å¥½å•Šï¼å•Šå“ˆå“ˆï¼

æ­£ç»ç‚¹è¯´ï¼š

1. `ID`å’Œ`Label`éƒ½æ˜¯å®å®åœ¨åœ¨å­˜åœ¨äºä»£ç†(`XYZ`å’Œ`ABC`)ï¼Œè€Œä¸æ˜¯åœ¨`Task`ä¸Šçš„ã€‚
2. é¢å‘å¯¹è±¡è®¾è®¡æ—¶ï¼Œå®ä¾‹å¸¸ä¼šå®šä¹‰å’Œç±»ç›¸åŒçš„å‡½æ•°åï¼Œä»¥æ­¤å¯ä»¥è¦†ç›–ç±»ä¸Šçš„æ–¹æ³•ï¼ŒOLOOè¿™æ˜¯ç›¸ååœ°ï¼ŒåŸºäºä»£ç†æœºåˆ¶ï¼Œæˆ‘ä»¬å°½å¯èƒ½å®šä¹‰ä¸åŒæ–¹æ³•ï¼Œè¿™å¯èƒ½æ²¡æœ‰å¾ˆæ˜æ˜¾çš„å¥½å¤„ï¼Œä½†æ˜¯ï¼Œä»£ç çš„ç»´æŠ¤å’Œå¯è¯»æ€§å°±å¤§å¤§åœ°æé«˜äº†ã€‚
3. `this.setID()`ï¼Œåœ¨`XYZ`å¯¹è±¡ä¸Šè°ƒç”¨`setID`æ–¹æ³•ï¼šå“Ÿï¼Œè¿™ä¸ªå¯¹è±¡ä¸Šæœ¨æœ‰ï¼Œ[[Prototype]]æ„å‘³ç€è¦å»`Task`çœ‹çœ‹ï¼Œå“Ÿï¼Œè¿˜çœŸæœ‰å‘€ï¼è¿™é‡Œï¼Œæ ¹æ®`this`çš„è°ƒç”¨æœºåˆ¶ï¼Œå¾ˆæ˜æ˜¾æ˜¯ç»‘å®šåˆ°XYZå¯¹è±¡ä¸Šçš„ï¼ˆä¸è®°å¾—å‘¢ï¼Ÿä½ ä¸«çš„å›å»å¤ä¹ å¤ä¹ thisç»‘å®šè§„åˆ™1234ğŸ˜¡)ã€‚

ä»£ç†æ–¹æ³•ï¼šåœ¨æŸå¯¹è±¡ä¸Šæ²¡æœ‰æ‰¾åˆ°å±æ€§æˆ–æ–¹æ³•æ—¶ï¼Œé€šè¿‡ä»£ç†ï¼Œä»¥ç´¢å¼•çš„æ–¹å¼é“¾æ¥åˆ°å¦å¤–çš„å¯¹è±¡ã€‚

### è°ƒè¯•

JSçš„è°ƒè¯•å°±æ˜¯è¦åˆ©ç”¨å¥½æµè§ˆå™¨ï¼Œå› ä¸ºæ²¡æœ‰æ ‡å‡†çš„æ–¹æ³•ï¼Œè€Œæ¯ä¸ªæµè§ˆå™¨åˆéƒ½æœ‰è‡ªå·±çš„ä¸€å¥—è§„åˆ™ï¼Œæˆ–è€…è¯´æŠ€æœ¯ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯¹JSçš„è°ƒè¯•éƒ½ä¸é‚£ä¹ˆç»Ÿä¸€ï¼š

```js
function Foo() {}
var a1 = new Foo();
a1; //Foo{}
```
æœ€åä¸€è¡Œä»£ç åœ¨Chromeå’ŒFirefoxä¸­ä¼šæœ‰å·®å¼‚ï¼Œæˆ‘ä»¬å°±ä¸æ·±ç©¶å·®å¼‚ä½•å¤„ï¼Œæˆ‘ä»¬ä»”ç»†ç ”ç©¶Chromeçš„è¡¨ç°å§ï¼

```js
function Foo() {}
var a1 = new Foo();
a1.constructor; //Foo(){};
a1.constructor.name; //Foo
```

ä»è¿™é‡Œæˆ‘ä»¬å°±æœ‰ç–‘æƒ‘äº†ï¼Œæ˜¯ä¸æ˜¯æˆ‘ä»¬è®¿é—®`a1`æ—¶ï¼ŒChromeå°±åªæ˜¯è®¿é—®äº†å®ƒçš„`constructor.name`å±æ€§å‘¢ï¼Ÿä»¤äººä¸è§£çš„æ˜¯ï¼Œæœ‰æ—¶æ˜¯è¿™ä¹ˆå›äº‹ï¼Œæœ‰æ—¶åˆä¸æ˜¯è¿™ä¹ˆå›äº‹çš„ã€‚

```js
function Foo() {}
var a1 = new Foo();
Foo.prototype.constructor = function Gotcha() {};
a1.constructor; //Gotcha(){};
a1.constructor.name; //Gotcha
a1; //Foo {}
```

ä¾ç„¶è¿”å›çš„æ˜¯`Foo`ï¼Œè¿™è¯´æ˜å¹¶ä¸æ˜¯ç›´æ¥è·å–`constructor.name`ï¼Œæ‰€ä»¥å¥½åƒçœ‹èµ·æ¥å¯¹ä¹‹å‰çš„é—®é¢˜æœ‰äº†ç­”æ¡ˆäº†ï¼Œä¸”æ…¢ï¼Œå†çœ‹çœ‹ä¸‹é¢**OLOO**é£æ ¼çš„ä»£ç ï¼š

```js
var Foo = {};
var a1 = Object.create( Foo );
a1; //Object
Object.defineProperty( Foo, 'constructor', {
				enumerable: false,
				value: function Gotcha() {}
});
a1; //Gotcha
```
åŸä½œè€…è¯´ï¼Œè¿™é‡Œè¿”å›`Gotcha`æ˜¯ä¸ªbugï¼Œè¯´ä»¥åç‰ˆæœ¬ä¼šæ”¹ï¼Œä½†æ˜¯æˆ‘ç°åœ¨è¿˜æ˜¯ä¸€æ ·çš„ï¼Œå…¶å®è¿™äº›çŸ¥è¯†æ˜¯ä¸€äº›çç¢çš„ç»†èŠ‚ï¼Œäº†è§£äº†è§£å°±å¥½çš„ã€‚

### æ¯”è¾ƒ

åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»åŸç†å±‚é¢ä¸Šäº†è§£äº†â€œç±»â€å’Œâ€œä»£ç†â€çš„ä¸€äº›å·®å¼‚ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹å®ƒä»¬ï¼š

é¢å‘â€œç±»â€ï¼ˆåŸå‹ï¼‰ï¼š

```js
function Foo(who) {
				this.me = who;
}

Foo.prototype.identify = function() {
				return "I am " + this.name;
};

function Bar(who) {
				Foo.call( this, who );
}

Bar.prototype.speak = function() {
				console.log( "Hello, " + this.identify() + ".");
};

var b1 = new Bar( "b1" );
var b2 = new Bra( "b2" );
b1.speak();
b2.speak();
```
è¿™é‡Œæœ‰é¡¶å±‚çˆ¶ç±»`Foo`ï¼Œ`Bar`ç»§æ‰¿äºå®ƒï¼Œè€Œç”±`Bar`â€œæ„é€ â€å‡º`b1`,`b2`ã€‚`b1`ä»£ç†åˆ°`Bar.prototype`ï¼Œè€Œ`Bar.prototype`ä»£ç†åˆ°`Foo.prototype`ä¸Šã€‚

**OLOO**é£æ ¼ï¼š

```js
var Foo = {
				init: function(who) {
								this.me = who;
				},
				identify: function() {
								return "I am " + this.me;
				}
};

var Bar = Object.create( Foo );
Bar.speak = function() {
				console.log( "Hello, " + this.identify() + ".");
};
var b1 = Object.create( Bar );
b1.init( "b1" );
var b2 = Object.create( Bar );
b2.init( "b2" );
b1.speak();
b2.speak();
```

åŒæ ·ï¼Œæˆ‘ä»¬å»ºç«‹èµ·äº†`b1`-->`Bar`-->`Foo`é—´çš„è”ç³»ï¼Œå’ŒOOé£æ ¼ä¸€æ ·ï¼Œä½†æ˜¯æˆ‘ä»¬ç®€åŒ–äº†æ•´ä¸ªä»£ç ï¼Œä»…ä»…åªæ˜¯å»ºç«‹äº†è¿™ä¸ªä¸‰ä¸ªå¯¹è±¡çš„é“¾æ¥ï¼Œè€Œä¸”çœ‹èµ·æ¥ä¹Ÿä¸æƒ³ç±»ï¼ˆæœ¬èº«å°±ä¸æ˜¯ç±»ï¼Œåªæ˜¯æ¨¡æ‹Ÿäº†ä¸€ä¸‹è€Œå·²ï¼‰ã€‚

æˆ‘ä»¬çœ‹çœ‹äºŒè€…çš„æ¨¡å‹ï¼š

![æ¨¡æ‹Ÿç±»çš„æ¨¡å‹](../this\ \&\ object\ prototypes/fig4.png)

![æ¨¡æ‹Ÿç±»çš„ç®€åŒ–æ¨¡å‹](../this\ \&\ object\ prototypes/fig5.png)

![OLOOæ¨¡å‹](../this\ \&\ object\ prototypes/fig6.png)

è¿™ä¸‰ä¸ªå›¾ä¸€å‡ºï¼Œæˆ‘æƒ³æˆ‘ä»¬éƒ½ä¼šé€‰æ‹©æœ€ç®€å•çš„æ¨¡å‹å§ï¼Œæœ€åä¸€ä¸ªç§æ–¹æ³•å°±æ˜¯æˆ‘ä»¬ä¸Šé¢æåŠçš„**OLOO**é£æ ¼çš„ç¼–ç ï¼Œå®ƒå°‘äº†å¾ˆå¤šå¯èƒ½å‡ºç°é—®é¢˜çš„ç¯èŠ‚ï¼Œä½†æ˜¯ä¹Ÿæ˜¯æœ€å¤§ç¨‹åº¦çš„åˆ©ç”¨äº†æˆ‘ä»¬çš„åŸå‹é“¾æ¥å®ç°ç»§æ‰¿æˆ–è€…è¯´æ˜¯ä»£ç†ï¼Œä¹Ÿå°±æ˜¯å®Œæˆäº†æˆ‘ä»¬æœ€æ ¸å¿ƒæœ€å®è´¨çš„éœ€æ±‚ï¼šå»ºç«‹å¯¹è±¡é—´çš„è”ç³»ã€‚

### æ˜†ä»‘è®ºå‰‘

æˆ‘ä»¬è¯´äº†å¾ˆå¤šå…³äºç±»å’Œå¯¹è±¡é—´çš„ç†è®ºæ€§å·®å¼‚ç­‰ï¼Œä½†æ˜¯å®è·µèµ·æ¥çœŸçš„æœ‰è¯´èµ·æ¥è¿™ä¹ˆå¥½å¬å¥½å—ï¼Ÿ*Talk is cheaper, show me the code*.æˆ‘ä»¬ç”¨ä¸€ä¸ªwidgetæ¥è¯•è¯•ã€‚

#### ç±»widget

æˆ‘ä»¬å¯èƒ½æ›¾ç»ä¹ æƒ¯ä½¿ç”¨OOçš„è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬å¯èƒ½èƒ½ç«‹åˆ»ç»™å‡ºä¸€ä¸ªæ–¹æ¡ˆï¼šæ¥ä¸ªä¸€ä¸ªçˆ¶ç±»ï¼ˆWidgetï¼‰ï¼Œå®ƒæœ‰å„ç§widgetçš„å…±åŒå±æ€§ï¼Œæ¥ç€åŸºäºå®ƒåˆ›å»ºä¸€ä¸ªå­ç±»ï¼ˆæ¯”å¦‚æŒ‰é’®ï¼‰ï¼Œä»ä»£ç å±‚é¢æ¥è¯´
å°±æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š

```js

//parent class
function Widget(width, height) {
				this.width = width || 50;
				this.height = height || 50;
				this.$element = null;
}

//add method
Widget.prototype.render = function($where) {
				if(this.$element) {
								this.$element.css( {
												width: this.width + 'px';
												height: this.height + 'px';
								}).appendTo( $where );
				}
};

//Child class
function Button(width, height, label) {
				//super constructor call
				Widget.call(this, width, height);
				this.label = label || 'Default';
				this.$element = $('<button>').text( this.$label );
}

//make Button inherit from Widget
Button.prototype =Object.create( Widget.prototype );
//overwrite base inherited render method
Button.prototype.render = function($where) {
				//super call
				Widget.prototype.render.call( this. $element );
				ths.$element.click ( this.onClick.bind( this ) );
};
Button.prototype.onClick = function(event) {
				console.log( "Button '" + this.label + "' clicked! " );
};

$(document).ready( function() {
				var $body = $(document.body);
				var btn1 = new Button( 125, 30, "Hello");
				var btn2 = new Button( 150, 40, "world");
				btn1.render( $body );
				btn2.render( $body );
});
```
#### *ES6* `class`

å…ˆä¸æå§ï¼

#### OLOOé£æ ¼

æˆ‘ä»¬å°è¯•ç”¨OLOOé£æ ¼æ¥å®ç°ä¸‹ï¼š

```js
var Widget = {
				init: function( width, height) {
								this.width = width || 50;
								this.height = width || 50;
								this.$element = null;
				},
				insert: function( $where ) {
								if(this.$element) {
												this.$element.css({
																width: this.width + 'px';
																height: this.height + 'px';
												}).appendTo( $where );
								}
				}
};

var Button = Object.create( Widget );
Button.setup = function(width, height, label) {
				this.init( width, height);
				this.label = label || 'default';
				this.$element = $( '<button>').text( this.label );
};

Button.build = function($where) {
				//delegated call
				this.insert ( $where );
				this.$element.click ( this.onClick.bind (this));
};

Button.onClick = function(event) {
				console.log( "Button '" + this.label + " 'clicked!");
};

$( document ).ready( function() {
				var $body = $( document.body );
				var btn1 = Object.create( Button );
				btn1.setup( 125,30,"LOL");
				btn1.build( $body );
};
```

æˆ‘ä»¬ä¸æŠŠWidgetå½“åšæ˜¯ä¸€ä¸ªçˆ¶ç±»ï¼ŒåŒæ ·ä¹Ÿä¸æŠŠButtonå½“åšå®ƒçš„ä¸€ä¸ªå­ç±»ï¼Œå®ƒä»¬éƒ½æ˜¯ç‹¬ç«‹çš„ä¸€ä¸ªå¯¹è±¡ï¼ŒWidgetæ˜¯ä¸€ä¸ªæœ‰å„ç§å¥½ç”¨å±æ€§å’Œæ–¹æ³•çš„é›†åˆï¼Œä»»ä½•ç‰¹å®šçš„widgetéƒ½å¯èƒ½ä»£ç†åˆ°å®ƒï¼Œ
è€Œæˆ‘ä»¬çš„Buttonåˆšå¥½å»ºç«‹äº†è¿™ä¹ˆä¸ªä»£ç†å…³ç³»ã€‚

OLOOé£æ ¼çš„ä»£ç çœ‹èµ·æ¥æ›´ç®€å•ï¼Œæ˜äº†ï¼Œè”æƒ³åˆ°æˆ‘ä»¬çš„æ¨¡å‹ï¼Œå®ƒä¹Ÿç¡®å®ç®€å•å¾ˆå¤šï¼Œä¹Ÿå’©æœ‰`prototype`ç­‰å¹²æ‰°ï¼Œæ€»è€Œè¨€ä¹‹ï¼Œåœ¨å®ŒæˆåŠŸèƒ½çš„å‰æä¸‹ï¼Œæˆ‘ä»¬æŠŠæ¶æ„ç®€åŒ–äº†ï¼Œè¿™ä¹Ÿæ˜¯é™ä½é”™è¯¯
ä¸€ä¸ªæ–¹å‘ã€‚

#### ç®€æ´çš„è®¾è®¡

OLOOç»™æˆ‘ä»¬æ›´ç®€å•ï¼Œæ›´çµæ´»åœ°è®¾è®¡é£æ ¼ï¼Œé€šè¿‡ä»£ç†çš„æ–¹å¼å¯ä»¥è®©æˆ‘ä»¬çš„æ‹¥æœ‰å¼ºå£®çš„ä»£ç æ¶æ„ï¼Œæˆ‘ä»¬åœ¨æ¥çœ‹çœ‹ä¸€äº›ä¾‹å­ï¼š

ä¸¤ä¸ªæ§åˆ¶å™¨ï¼Œä¸€ä¸ªæ˜¯ç™»å½•ï¼Œä¸€ä¸ªæ˜¯æœåŠ¡å™¨æˆæƒã€‚

ç»å…¸çš„ç±»è®¾è®¡é£æ ¼ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªä»»åŠ¡åˆ†å‰²æˆä¸€ä¸ªåŸºç¡€ç±»ï¼ˆControllerï¼‰ï¼Œå†åˆ†æ”¯å¤„ä¸¤ä¸ªå­ç±»*LoginController*å’Œ*AuthController*ï¼Œå®ƒä»¬éƒ½ç»§æ‰¿ä¸*Controller*ï¼Œå¹¶æ‹¥æœ‰è‡ªå·±çš„
ç‰¹å®šçš„æ–¹æ³•ï¼š

```js
//parent class
function Controller() {
				this.errors = [];
};

Controller.prototype.showDiag = function( title, message ) {
				//display title message to user in a dialog
};
Controller.prototype.success = function( message ) {
				this.showDialog( "Sucess", message );
};
Controller.prototype.failure = function( error ) {
				this.errors.push( error );
				this.showDialog( "Error", error );
};
```

```js
//child class
function LoginController() {
				Controller.call( this );
}

//link child class to parent
LoginController.prototype = Object.create( Controller.prototype );
LogonController.prototype.getUser = function() {
				return document.getElementById( 'login_username' ).value;
};
LoginController.prototype.getPassword = function() {
				return document.getElementById( 'login_password' ).value;
}

LoginController.prototype.validateEntry = function(user,password) {
				user = user || this.getUser;
				password = password || this.getPassword;
				if( !(user password) ) {
								return this.failuer( 'Please enter a username and password' );
				}else if( password.length <= 5 ) {
								return this.faliure ( 'Password must be 6 characters and above!' );
				}
				//be here? validated
				return true;
};

//Override to extend base 'failure()'
LoginController.prototype.failure = function( error ) {
				//super call
				Controller.prototype.failuer.call( this, "Login invalid: " + error;
};
```

```js

//child class
function AuthController(login) {
				Controller.call ( this );
				//in addtion to inheritance, we also need composition
				this.login = login;
}
//link child class to parent
AuthController.prototype = Object.create( Controller.prototype );
AuthController.prototype.server = function( url, data ) {
				return $.ajax( {
								url: url,
								data: data 
				});
};

AuthController.prototype.checkAuth = function() {
				var user = this.login.getUser();
				var password = this.login.getPassword();

				if( this.login.validateEntry ( user, password ) ) {
								this.server( '/check-auth', {
												user: user,
												password: password
								})
								.then( this.success.bind ( this ) )
								.fail( this.failure.bind( this ) );
				}
};

//override to extend base 'success()'
AuthController.prototype.success = function() {
				//super call
				Controller.prototype.success.call( this, "Authenticated");
};

//override to extend base 'failure()'
AuthController.prototype.failure = function(error) {
				//super call
				Controller.prototype.failure.call( this, "Auth Failed: " + error );
};
```

```js
var auth = new AuthController(
//in addtion to inheritance, we also need composition
new LoginController()
);
auth.checkAuth();
```

ä»£ç æ¯”è¾ƒå¤šï¼Œéœ€è¦ä»”ç»†ä½“ä¼šï¼

#### å»ç±»åŒ–

ä¸Šé¢çš„ä»£ç å¯¹æˆ‘è¿™ä¸ªä¸€å¼€å§‹å°±æ¥è§¦JavaScriptè€Œè¨€ï¼Œä¹Ÿä¸æ˜¯é‚£ä¹ˆå®¹æ˜“æ‡‚ï¼Œæˆ‘ä»¬å…ˆæ”¾ç½®ï¼Œå…ˆçœ‹çœ‹OLOOé£æ ¼æ˜¯å¦‚ä½•å……åˆ†åˆ©ç”¨å¥½åŸå‹ç»§æ‰¿çš„å‰æä¸‹ï¼Œç®€åŒ–å®ç°æˆ‘ä»¬çš„åŠŸèƒ½ï¼š

```js
var LoginController = {
				errors: [],
				getUser: function() {
								return document.getElementById( 'login_username' ).value;
				},
				getPassword: function() {
								return document.getElmenetById( 'login_password' ).value;
				},
				validateEntry: function( user, password ) {
								user = user || this.getUser();
								password = password || this.getPassword();
								if( ! (user && password) ) {
												return this.failure ( 'Please enter a username and password!');
								}else if( password.length < 5 ) {
												return this.failure( 'Password must be 5+ characters!' );
								}
								//get here? validated!!
								return true;
				},
				showDialog: function(title, message) {
								//display some errors
				},
				failure: function( errors ) {
								this.errors.push( errors );
								this.showDialog( 'Error: ', 'Login invalid: ' + errors );
				}
};
```

```js
//link authController to delegate to LoginController
var AuthController = Object.create( LoginController );
AuthController.errors = [];
AuthContoller.checkAuth = function() {
				var user = this.getUser();
				var passwrod = this.getPassword();
				if( this.validateEntry( user, password )) {
								this.server( '/check-auth', {
												user: user,
												password: password
												})
												.then( this.accepted.bind( this ))
												.fail( this.rejected.bind( this ))
												}
};
AuthController.server = function( url, data ) {
				return $.ajax( {
								url: url,
								data: data
				});
};
AuthController.accepted = function() {
				this.showDialog ( 'Sucess', 'Authenticated' );
};
AuthController.rejected = function() {
				this.failure ( 'Auth Failed: ' + errors );
};
```

å› ä¸º`AuthController`ä»…ä»…å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œ`LoginController`åŒæ ·ä¹Ÿåªæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬ä¸éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œå®ä¾‹åŒ–æ¥ä½¿ç”¨ï¼Œéœ€è¦è°ƒç”¨å®ƒåªè¦ï¼š

```js
AuthController.checkAuth();
```

å½“ç„¶ï¼Œå¦‚æœä½ éœ€è¦åˆ©ç”¨ä»£ç†é“¾æ¥åˆ›å»ºæ›´å¤šçš„å¯¹è±¡ï¼Œä¹Ÿå¾ˆç®€å•ï¼š

```js
var controller1 = Object.create( AuthController );
var controller2 = Object.create( AuthController );
```
é€šè¿‡ä»£ç†ï¼Œ`AuthController`å’Œ`LoginController`éƒ½ä»…ä»…åªæ˜¯å¯¹è±¡ï¼Œå¹³çº§çš„å¯¹è±¡ï¼Œå®ƒä»¬é—´å¯ä»¥éšæ„æ›´æ”¹ä»£ç†å…³ç³»æ¥å®ç°æˆ‘ä»¬çš„åŠŸèƒ½éœ€æ±‚ï¼Œå¦å¤–OLOOé£æ ¼çš„ç¼–ç æ–¹å¼ä½¿å¾—æˆ‘ä»¬ä»…æœ‰ä¸¤ä¸ªå…¥å£ï¼ˆ`LoginController`å’Œ`AuthController`ï¼Œæ²¡æœ‰æ›´å¤šçš„ã€‚

æˆ‘ä»¬ä¸éœ€è¦ä¸€ä¸ªå…¬å…±çš„`Controller`æ¥å…±äº«ä¸€äº›å±æ€§ï¼Œå› ä¸ºåŸå‹é“¾çš„ç‰¹æ€§æœ¬èº«å°±æäº†æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½ï¼ŒåŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªç±»ï¼Œå› ä¸ºç±»çš„æ¦‚å¿µåœ¨JavaScriptæ˜¯ä¸å­˜åœ¨çš„ï¼Œåªæœ‰å¯¹è±¡è€Œå·²ã€‚å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦ç»„åˆå®ƒä»¬ï¼Œä»£ç†ä½¿å¾—ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œåœ°å·®å¼‚åŒ–åˆä½œã€‚

æœ€åï¼Œæˆ‘ä»¬åº”é¿å…åº”ç”¨ç›¸åŒçš„å±æ€§æˆ–æ–¹æ³•åæ¥â€è¦†ç›–â€œï¼Œæ¯”å¦‚`accepte, reject`å’Œ`success, failure`çš„å·®å¼‚ï¼Œä½¿ç”¨æ›´æ˜ç¡®çš„å˜é‡åæ¥æè¿°æˆ‘ä»¬æ›´åŠ ç‹¬ç‰¹çš„ç‰¹æ€§ï¼Œä»£ç ç»“æ„ç®€å•ï¼Œé€»è¾‘æ¸…æ™°ã€‚

### æ€»ç»“

ç±»ä¸ç»§æ‰¿æ˜¯åœ¨è½¯ä»¶æ¶æ„ä¸­ï¼Œä½ å¯ä»¥é€‰æ‹©æˆ–è€…å¿½ç•¥çš„è®¾è®¡æ¨¡å¼ã€‚å¤§å¤šæ•°å¼€å‘è€…è®¤ä¸ºâ€ç±»â€œæ˜¯ä»…æœ‰çš„æˆ–è€…è¯´åˆé€‚çš„æ–¹æ³•æ¥ç»„ç»‡ä»£ç ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œå±•ç°äº†ä¸€ç§åŒæ ·æœ‰æ•ˆï¼Œè€Œä¸”æ›´åŠ ç®€æ´ï¼Œæ¸…æ™°çš„å®ç°æ–¹æ³•ï¼šä»£ç†(behavior delegation)ã€‚

*Behavior delegation*å»ºè®®æˆ‘ä»¬å¹³çº§åŒ–å¯¹è±¡ï¼Œé€šè¿‡ä»£ç†å»ºç«‹ç›¸äº’çš„è”ç³»ï¼Œè€Œä¸æ˜¯å»ºç«‹çˆ¶ç±»ä¸å­ç±»çš„å…³ç³»ã€‚JavaScriptçš„åŸå‹ç‰¹æ€§æ˜¯å¾ˆè‡ªç„¶è¯­æ³•å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥å……åˆ†åˆ©ç”¨å®ƒæ¥å®ç°å¯¹è±¡çš„è”ç³»ã€‚

**OLOO**åˆ©ç”¨JavaScriptçš„åŸç”Ÿçš„åŸå‹ç»§æ‰¿é“¾æ¥å®ç°å¯¹è±¡çš„å…³è”ï¼Œè€Œä¸éœ€è¦å»æ¨¡æ‹Ÿâ€ç±»â€œè¿™ç§å®é™…ä¸å­˜äºJavaScriptä¸­çš„ä¸å‹å¥½ï¼ˆè‡³å°‘ä»£ç å±‚å’Œæ¨¡å‹ï¼‰æ¥å®ç°å¯¹è±¡é—´çš„è”ç³»ï¼ŒåŠŸèƒ½ä¸Šæ²¡æœ‰å·®å¼‚ï¼Œç®€æ´ï¼Œé€»è¾‘æ›´åŠ æ¸…æ™°åœ°åˆ©ç”¨[[Prototype]]ï¼Œæˆ‘ä»¬ä½•ä¹è€Œä¸ä¸ºå‘¢ï¼Ÿ



				

				
								

















